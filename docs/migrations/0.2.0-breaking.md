# 0.2.0 Breaking Migration

## 概览

`0.2.0` 是破坏式重构版本：

- 外部子命令入口被移除
- 配置结构从旧模型迁移到 `source/behavior/outputs`
- 运行时解码切换为 schema 控制帧（HELLO/CHUNK/COMMIT）

## 配置迁移

旧配置块：

- `[rttd]`（已重命名为 `[ratd]`）
- `project.ignore_dirs`
- `generation.toml_name`
- `[ratd.server]`
- `[ratd.foxglove]`
- `ratd.source.preferred_backend`
- `[ratd.source.backend]`
- `ratd.behavior.auto_sync_on_start`
- `ratd.behavior.auto_sync_on_reset`
- `ratd.behavior.sync_debounce_ms`

新配置块：

- `.rttdignore`（唯一扫描过滤入口）
- `[ratd.source]`
- `[ratd.behavior]`
- `[ratd.outputs.jsonl]`
- `[ratd.outputs.foxglove]`

运行边界：

- `ratd` 不再启动或托管 backend 进程，仅连接既有 RTT 端点。
- `ratd` 不再触发 sync；同步入口改为 `ratsync`。

## 运行迁移

新入口：

```bash
cargo run -p ratsync -- --config <path/to/rat.toml>
# build + flash firmware
cargo run -p ratd -- --config <path/to/rat.toml>
```

运行控制迁移到命令台：

- source 切换：`$source list` / `$source use <index>`
- 输出控制：`$foxglove on|off`、`$jsonl on|off [path]`

## 常见失败与处理

- 配置加载失败：检查是否仍使用旧配置块
- schema 超时：确认固件会发送 schema 控制帧，或增大 `ratd.behavior.schema_timeout`
- schema hash 不一致：确认固件发送的是完整 schema 数据
